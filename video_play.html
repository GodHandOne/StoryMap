<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>基于位置的Web AR视频播放示例</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- 引入A-Frame AR模式 -->
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
</head>
<body style='margin: 0; overflow: hidden;'>
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
        <!-- 视频资产定义 -->
        <a-assets>
            <video id="video" autoplay loop="true" src="assets/asset.mp4"></video>
        </a-assets>
        <!-- 视频实体，使用自定义的视频控件 -->
        <a-video src="#video" width="2.6" height="1.5" position="0 1 -3"  look-at="[gps-camera]" 
            gps-entity-place="latitude:32.117120;longitude:118.911040;"></a-video>
        <a-camera gps-camera="simulateLatitude:32.117118;simulateLongitude:118.911037"
            rotation-reader></a-camera>
    </a-scene>

    <script>
        // Haversine公式计算两点之间的距离（以米为单位）
        function getDistanceFromLatLonInM(lat1,lon1,lat2,lon2) {
          var R = 6371; // 地球半径，单位是公里
          var dLat = deg2rad(lat2-lat1);
          var dLon = deg2rad(lon2-lon1); 
          var a = 
            Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
            Math.sin(dLon/2) * Math.sin(dLon/2); 
          var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
          var distance = R * c * 1000; // 距离，单位是米
          return distance;
        }
      
        function deg2rad(deg) {
          return deg * (Math.PI/180)
        }
      
        document.addEventListener('DOMContentLoaded', function () {
          const videoElement = document.querySelector('a-video');
          const cameraElement = document.querySelector('a-camera');
          
          // 模拟的经纬度位置
          const simulateLat = cameraElement.getAttribute('gps-camera').simulateLat
          const simulateLong = cameraElement.getAttribute('gps-camera').simulateLong
          
          // 视频的GPS位置
          const videoLat = parseFloat(videoElement.getAttribute('gps-entity-place').latitude)
          const videoLong = parseFloat(videoElement.getAttribute('gps-entity-place').longitude)
      
          // 检查距离并决定是否显示视频
          function checkDistanceAndDisplayVideo() {
            const distance = getDistanceFromLatLonInM(simulateLat, simulateLong, videoLat, videoLong);
            
            if (distance > 10) { // 如果距离超过10米
              videoElement.setAttribute('visible', 'false'); // 隐藏视频
            } else {
              videoElement.setAttribute('visible', 'true'); // 显示视频
            }
          }
      
          // 在场景加载完成后执行一次距离检查
          document.querySelector('a-scene').addEventListener('loaded', checkDistanceAndDisplayVideo);
        });
      </script>
      
    <!--控制视频的播放，点击任意地方-->
    <script>
        document.body.addEventListener('click', function () {
            const video = document.querySelector('#video');
            if (video.paused) {
                video.play();
            }
        }, { once: true }); // 使用 once 确保事件只触发一次
    </script>
    

    <script>
        // 模拟位置检测并控制视频
        document.addEventListener('DOMContentLoaded', () => {
            // 获取视频元素
            const video = document.querySelector('#video');

            // 模拟到达指定位置后播放视频
            function checkLocationAndPlayVideo() {
                // 假设用户已到达指定位置，可以在这里添加真实的地理位置检测逻辑
                const atLocation = true;

                if (atLocation) {
                    video.play();
                } else {
                    video.pause(); // 或者根据需要停止视频
                }
            }

            // 模拟位置检测，实际开发中需要替换为真实的地理位置API调用
            checkLocationAndPlayVideo();
        });
    </script>
    
</body>
</html>
